<!doctype html>
<html>
<head>
    <title>Available Classes</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .circle {
            height: 12px;
            width: 12px;
            background-color: black;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
    <script>
        $(document).ready(function() {
            $('input[type="checkbox"]').change(function() {
                let selectedClassIds = $('input[type="checkbox"]:checked').map(function() {
                    return $(this).val();
                }).get();

                if (selectedClassIds.length > 0) {
                    $.ajax({
                        url: "/class_times",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({ class_ids: selectedClassIds }),
                        success: function(response) {
                            $('#classTimes').empty().append(`
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Class Name</th>
                                            <th>Time</th>
                                            <th>Mon</th>
                                            <th>Tue</th>
                                            <th>Wed</th>
                                            <th>Thu</th>
                                            <th>Fri</th>
                                            <th>Sat</th>
                                            <th>Sun</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            `);

                            $.each(response, function(classId, times) {
                                $.each(times, function(i, time) {
                                    let days = {
                                        "Mon": time.days.includes("M") ? '<span class="circle"></span>' : "",
                                        "Tue": time.days.includes("Tu") ? '<span class="circle"></span>' : "",
                                        "Wed": time.days.includes("W") ? '<span class="circle"></span>' : "",
                                        "Thu": time.days.includes("Th") ? '<span class="circle"></span>' : "",
                                        "Fri": time.days.includes("F") ? '<span class="circle"></span>' : "",
                                        "Sat": time.days.includes("Sa") ? '<span class="circle"></span>' : "",
                                        "Sun": time.days.includes("Su") ? '<span class="circle"></span>' : ""
                                    };
                                    $('#classTimes tbody').append(`
                                        <tr>
                                            <td>${classId}</td>
                                            <td>${time.start_time} - ${time.end_time}</td>
                                            <td>${days.Mon}</td>
                                            <td>${days.Tue}</td>
                                            <td>${days.Wed}</td>
                                            <td>${days.Thu}</td>
                                            <td>${days.Fri}</td>
                                            <td>${days.Sat}</td>
                                            <td>${days.Sun}</td>
                                        </tr>
                                    `);
                                });
                            });
                        }
                    });
                } else {
                    $('#classTimes').empty();
                }
            });
        });
    </script>
</head>
<body>
    <h1>Select Available Classes</h1>
    <form id="classForm">
        {% for class in classes %}
            <div>
                <input type="checkbox" id="class{{ class['id'] }}" value="{{ class['id'] }}">
                <label for="class{{ class['id'] }}">{{ class['class_id'] }}</label>
            </div>
        {% endfor %}
    </form>
    <div id="classTimes"></div>
</body>
</html>
